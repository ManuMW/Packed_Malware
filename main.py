
import os.path
import pefile
import peutils


#def detection():
    #signatures = peutils.SignatureDatabase('userdb.txt')


if __name__ == '__main__':
    file = r'C:\Users\ASUS\Downloads\Testing\VirtualBox-6.1.22-144080-Win.exe'
    my_file = os.path.abspath(file)
    signatures = peutils.SignatureDatabase(r'C:\Users\ASUS\PycharmProjects\Packed Malware\userdb.txt')


    pe = pefile.PE(my_file)
    print("Sections: ", end='')
    print("\t\tEntropy\n")
    for sect in pe.sections:
        print("%17s" % (sect.Name).decode('utf-8'), end='')
        print(("\t%5.2f" % sect.get_entropy()))
    matches = signatures.match(pe, ep_only=True)
    print(matches,"gfkasgf")
    print("The entry point of the file is: ",pe.OPTIONAL_HEADER.AddressOfEntryPoint)
    if pe.OPTIONAL_HEADER.AddressOfEntryPoint == None:
        print("The file is packed")
    else:
        print("The file may not be packed")


   # if sect.get_entropy() > 6.5:
   #     print("The file packed")
    #    detection()